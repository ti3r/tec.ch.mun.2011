#{extends 'main.html' /}
#{set title:'Home' /}

<table style="width: 100%">
	<tr>
		<td valign="top" width="50%">
			<div class="evento-div" id="eventos">
			#{ifnot eventos}
				<h1 align="center"><span>&{'index.noEventos'}</span></h1>
			#{/ifnot}
			#{list items:eventos, as:'evento'}
				
				<fieldset class="evento-div" style="border-color: ${evento.mesa.color}" >
					<legend>
						<a href="@{showMesa()}?id=${evento.mesa.id}">
							<b>${evento.mesa.nombre}</b>
						</a>
					</legend>
					<table style="width:100%">
						<thead align="center">
							<tr>
								<th>
									<a href="/eventos/${evento.id}">${evento.titulo}</a>
								</th>
							</tr>
						</thead>
						<tbody align="center">
							<tr>
								<td>
									${evento.descripcion}
								</td>
							</tr>
						</tbody>
						<tfoot align="right">
							<tr>
								<td>
									${evento.fecha} - <a href="mailto:${evento.mesa.representante.correo}">${evento.mesa.representante.nombre}</a>
								</td>
							</tr>
						</tfoot>
					</table>
				</fieldset>
			#{/list}
			</div>
		</td>
		<td valign="top" width="50%">
			<div class="evento-div" id="noticias">
				<h1 align="center"><span>&{'index.noticias'}</span></h1>
				#{list items:mensajes, as:'mensaje'}
					<div>
					<p>${mensaje.mensaje}</p>
					<div id="social" align="right">
					<div id="fb-root"></div>
					<script>(function(d, s, id) {
					  var js, fjs = d.getElementsByTagName(s)[0];
					  if (d.getElementById(id)) {return;}
					  js = d.createElement(s); js.id = id;
					  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
					  fjs.parentNode.insertBefore(js, fjs);
					}(document, 'script', 'facebook-jssdk'));</script>
				
					<div class="fb-like" data-href="http://tec-ch-mun-2011.herokuapp.com/mesajes/${mensaje.id}" 
						data-send="false" 
						data-layout="button_count" 
						data-show-faces="false"></div>
					
					<a href="https://twitter.com/share" class="twitter-share-button"
						data-url="http://tec-ch-mun-2011.herokuapp.com/mesajes/${mensaje.id}"
						data-text="&{'showEvento.tweeterMsg'}" 
						data-count="horizontal">Tweet</a>
					<script type="text/javascript" src="//platform.twitter.com/widgets.js">
					</script>
					
					<!-- Place this tag where you want the +1 button to render -->
					<g:plusone size="medium" href="http://tec-ch-mun-2011.herokuapp.com/mesajes/${mensaje.id}"></g:plusone>
					
					<!-- Place this render call where appropriate -->
					<script type="text/javascript">
					  (function() {
					    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
					    po.src = 'https://apis.google.com/js/plusone.js';
					    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
					  })();
					</script>
					</div>
					</div>
				#{/list}
			</div>
		</td>
	</tr>
</table>

<!-- 
#{if moreFetch}
<input type="button" id="masEventos" value="&{'index.masEventos','Mas Eventos'}" />
#{/if}
 -->
 
<script type="text/javascript">
	var page = 0${page};
	
	$(document).ready(function(){
		if ($('#masEventos')){
			$('#masEventos').click(function(){
				$.get('/rest/eventos/mas/'+page,
						function(data){
							$(data.eventos).each(function(id, object){
								var objectHtml = '';
								objectHtml = '<fieldset ';
								objectHtml+=' class="evento-div" ';
								objectHtml+=' style="border-color:'+object.mesa.color+'"';
								objectHtml+='"'+object.mesa.nombre+'" >';
								objectHtml+=' <legend><b>'+object.mesa.nombre+'</b></legend> ';
								objectHtml+='<table style="width:100%">';
								objectHtml+='<thead align="center">';
								objectHtml+='<tr><th>';
								objectHtml+='<a href="/eventos/'+object.id+'">'+object.titulo+'</a>';
								objectHtml+='</th></tr></thead><tbody align="center"><tr>';
								objectHtml+='<td>'+object.descripcion+'</td></tr></tbody>';
								objectHtml+='<tfoot align="right"><tr><td>';
								objectHtml+=object.fecha+' - ';
								objectHtml+='<a href="mailto:'+object.mesa.representante.correo+'" >';
								objectHtml+=object.mesa.representante.nombre+'</a>';
								objectHtml+='</td></tr></tfoot></table>';
								objectHtml+='</fieldset>';
								$('#eventos').append(objectHtml);
							});
							//Disable the button if no more events available
							if (!data.moreFetch){
								$('#masEventos').attr('disabled','disabled');
								//set the current page to the returned page
							}else{
								//set the returned page to the var
								page = data.page;
							}
						}
					);
				});
		}
	});
</script>